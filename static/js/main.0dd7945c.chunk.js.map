{"version":3,"sources":["api/index.ts","stores/root.ts","api/req.ts","containers/demo/demo.js","routes/index.tsx","App.tsx","index.tsx"],"names":["request","wrapSend","requestFunc","type","a","res","data","response","success","info","msg","status","setTimeout","sessionStorage","clear","window","location","replace","err_msg","Api","down","download","url","body","post","responseType","uploadAudio","payload","this","http","getAPI","common","baseURL","headers","Token","getItem","axios","create","createRequest","useStyles","makeStyles","theme","root","display","alignItems","wrapper","margin","spacing","position","buttonSuccess","backgroundColor","green","fabProgress","color","top","left","zIndex","buttonProgress","marginTop","marginLeft","demo","props","rec","Recorder","bitRate","sampleRate","disableEnvInFix","onProcess","buffers","powerLevel","bufferDuration","bufferSampleRate","wave","input","length","renderVisualization","hid","Paper","style","height","className","uploadFile","e","formData","FormData","append","api","then","resp","console","log","uploadFile2","blob","duration","recStart","call","IsOpen","start","set","mouseDown","setState","document","onmouseup","touchUp","recStop","touchDown","playAndStop","refs","audio","play","state","src","t","open","clearTimeout","WaveView","elem","isUserNotAllow","stop","URL","createObjectURL","loadings","recording","Container","maxWidth","Button","onClick","Grid","container","item","xs","Fab","variant","onMouseDown","onTouchStart","onTouchEnd","size","alignContent","controls","ref","Component","LoginContainer","lazy","Routes","path","component","React","browserHistory","createBrowserHistory","routingStore","RouterStore","history","syncHistoryWithStore","App","fallback","CssBaseline","RootStore","ReactDOM","render","getElementById"],"mappings":"uMAmCgBA,E,uGCjCD,M,qGCqCFC,EAAQ,uCAAG,WAAUC,EAAyBC,GAAnC,qBAAAC,EAAA,+EAGEF,IAHF,OAGVG,EAHU,OAITC,EAAQD,EAARC,KACPC,EAAW,CACPC,UAASL,GAAcG,EAAKE,QAC5BC,KAAMH,EAAKI,IACXJ,KAAMH,EAAOG,EAAOA,EAAKA,MARb,mDAWTA,EAAQ,KAAIC,SAAZD,KACqB,MAAxB,KAAIC,SAASI,OAZD,wBAaZC,YAAW,WACPC,eAAeC,QACfC,OAAOC,SAASC,QAAQ,YACzB,KAhBS,kBAiBL,CACHR,KAAM,yDACND,SAAS,IAnBD,QAsBhBD,EAAW,CACPC,QAASF,EAAKE,QACdC,KAAMH,EAAKY,QACXZ,KAAMA,GAzBM,iCA4BbC,GA5Ba,yDAAH,wDFjCRY,EAIT,WAAYnB,GAAmB,IAAD,gCAH9BA,aAG8B,OAF9BoB,UAE8B,OAKtBC,SALsB,sBAKX,4CAAAjB,EAAA,6DAAgBkB,EAAhB,+BAAsB,GAAIC,EAA1B,+BAAsC,GAAtC,SACGtB,GAAY,WAC1B,OAAO,EAAKD,QAAQwB,KAAeF,EAAKC,EAAM,CAACE,aAAc,WAC9D,QAHY,cACTpB,EADS,yBAIRA,GAJQ,2CALW,KAYtBmB,KAZsB,sBAYf,4CAAApB,EAAA,6DAAgBkB,EAAhB,+BAAsB,GAAIC,EAA1B,gCACOtB,GAAY,WAC1B,OAAO,EAAKD,QAAQwB,KAAeF,EAAKC,MAFjC,cACLlB,EADK,yBAIJA,GAJI,2CAZe,KAoB9BqB,YAAc,SAACC,GACX,OAAO,EAAKH,KAAL,cAAyBG,IApBhCC,KAAK5B,QAAUA,EAAQ6B,KACvBD,KAAKR,KAAOpB,EAAQoB,MAyBbU,GAFC9B,EEba,WACzB,IAAM+B,EAAS,CACXC,QAAS,GACTC,QAAS,CACL,eAAgB,mBAChBC,MAAOrB,eAAesB,QAAQ,WAKtC,MAAO,CACHN,KAFaO,IAAMC,OAAON,GAG1BX,KAAMgB,IAAMC,OAAN,eAAkBN,EAAlB,CAA0BN,aAAc,WFGhCa,GAFe,IAAInB,EAAInB,I,mGGnBvCuC,EAAYC,aAAW,SAACC,GAAD,MAAY,CACrCC,KAAM,CACFC,QAAS,OACTC,WAAY,UAEhBC,QAAS,CACLC,OAAQL,EAAMM,QAAQ,GACtBC,SAAU,YAEdC,cAAe,CACXC,gBAAiBC,IAAM,KACvB,UAAW,CACPD,gBAAiBC,IAAM,OAG/BC,YAAa,CACTC,MAAOF,IAAM,KACbH,SAAU,WACVM,KAAM,EACNC,MAAO,EACPC,OAAQ,GAEZC,eAAgB,CACZJ,MAAOF,IAAM,KACbH,SAAU,WACVM,IAAK,MACLC,KAAM,MACNG,WAAY,GACZC,YAAa,QAIAC,E,kDACjB,WAAYC,GAAQ,IAAD,8BACf,cAAMA,IASVC,IAAMC,IAAS,CACX5D,KAAM,MACN6D,QAAS,IACTC,WAAY,KACZC,iBAAiB,EACjBC,UAAW,SAACC,EAASC,EAAYC,EAAgBC,GAC7C,EAAKC,KAAKC,MAAML,EAAQA,EAAQM,OAAS,GAAIL,EAAYE,MAhB9C,EAoBnBI,oBAAsB,SAACC,GACnB,OAAO,kBAACC,EAAA,EAAD,CAAOC,MAAO,CAACC,OAAQ,QAASC,UAAU,cArBlC,EA0CnBC,WAAa,SAACC,GACV,IAAMC,EAAW,IAAIC,SACrBD,EAASE,OAAO,SAAUH,GAC1BI,EAAI5D,YAAYyD,GAAUI,MAAK,SAAAC,GAC3BC,QAAQC,IAAI,OAAQF,OA9CT,EAkDnBG,YAAc,SAACC,EAAMC,GACjB,IAAMV,EAAW,IAAIC,SACrBD,EAASE,OAAO,SAAUO,EAAMC,EAAW,QAC3CP,EAAI5D,YAAYyD,GAAUI,MAAK,SAAAC,GAC3BC,QAAQC,IAAI,OAAQF,OAtDT,EA0DnBM,SAAW,SAACC,GAIR,GAHAA,IAASA,EAAO,SAAUrF,GACtBA,GAAO+E,QAAQC,IAAIhF,EAAK,KAExB,EAAKoD,KAAOC,IAASiC,SAAU,CAC/B,EAAKlC,IAAImC,QACT,IAAMC,EAAM,EAAKpC,IAAIoC,IACrBT,QAAQC,IAAI,2BAASQ,EAAI/F,KAAO,IAAM+F,EAAIjC,WAAa,MAAQiC,EAAIlC,QAAU,aAE7E+B,EAAK,mCAnEM,EAuEnBI,UAAY,WACR,EAAKC,SAAS,CAACzF,OAAQ,cACvB,EAAKmF,WACLO,SAASC,UAAY,EAAKC,SA1EX,EA6EnBA,QAAU,WACN,EAAKH,SAAS,CAACzF,OAAQ,YACvB,EAAK6F,WA/EU,EAkFnBC,UAAY,WACR,EAAKL,SAAS,CAACzF,OAAQ,cACvB,EAAKmF,YApFU,EAsGnBY,YAAc,WACV,EAAKC,KAAKC,MAAMC,QArGhB,EAAKC,MAAQ,CACThD,IAAK,KACLnD,OAAQ,OACRoG,IAAK,IALM,E,gEAwBE,IAAD,OACVC,EAAIpG,YAAW,WACjB6E,QAAQC,IAAI,2KAAgC,KAC7C,KAEHD,QAAQC,IAAI,2FACZ9D,KAAKkC,IAAImD,MAAK,WACVC,aAAaF,GACbvB,QAAQC,IAAI,iFAAiB,GAC7B,EAAKlB,KAAOT,IAASoD,SAAS,CAACC,KAAM,iBAGtC,SAAC1G,EAAK2G,GACLH,aAAaF,GACbvB,QAAQC,KAAK2B,EAAiB,qBAAkB,IAAM,4BAAU3G,EAAK,Q,gCAiDlE,IAAD,OACNkB,KAAKkC,IAAIwD,MAAK,SAAC1B,EAAMC,GAEjB,EAAKF,YAAYC,EAAMC,GACvB,EAAKO,SAAS,CAACW,IAAKhG,OAAOwG,IAAIC,gBAAgB5B,KAAQ,WACnDH,QAAQC,IAAI,MAAO,EAAKoB,MAAMC,WAGnC,SAACrG,GACA+E,QAAQC,IAAI,4BAAUhF,EAAK,Q,+BAUzB,IAAD,SAC2BkB,KAAKkF,MAA9BnG,EADF,EACEA,OAAkBoG,GADpB,EACUU,SADV,EACoBV,KACnBW,EAAuB,cAAX/G,EAClB,OACI,kBAACgH,EAAA,EAAD,CAAWC,SAAS,MAChB,6BACI,kBAACC,EAAA,EAAD,CAAQ1H,KAAK,UAAU2H,QAAS,kBAAM,EAAKhC,aAA3C,aAGA,kBAAC+B,EAAA,EAAD,CAAQ1H,KAAK,UAAU2H,QAAS,kBAAM,EAAKtB,YAA3C,aAIJ,kBAACuB,EAAA,EAAD,CAAMC,WAAS,EAACjF,QAAS,EAAGiC,UAAWzC,EAAUM,QAASD,WAAY,UAClE,kBAACmF,EAAA,EAAD,CAAME,MAAI,EAACC,GAAI,GACX,kBAACC,EAAA,EAAD,CACIC,QAAQ,WACRC,YAAazG,KAAKuE,UAClBmC,aAAc1G,KAAK6E,UACnB8B,WAAY3G,KAAK2E,QACjBiC,KAAK,SACLnF,MAAOqE,EAAY,UAAY,WACjCA,EAAY,2BAAS,6BAG3B,kBAACK,EAAA,EAAD,CAAME,MAAI,EAACC,GAAI,GACVtG,KAAK+C,uBAEV,kBAACoD,EAAA,EAAD,CAAME,MAAI,EAACC,GAAI,EAAGO,aAAc,UAC5B,kBAACZ,EAAA,EAAD,CAAQxE,MAAM,YAAY+E,QAAQ,YAAYN,QAASlG,KAAK8E,aAA5D,SAEJ,2BAAOgC,UAAQ,EAACC,IAAK,QAAS5B,IAAKA,EAAKjC,MAAO,CAACnC,QAAS,iB,GA1I3CiG,aC3C5BC,EAAiBC,gBAAK,kBAAM,uDAgBnBC,EAdf,uKAEQ,OACI,oCACI,kBAAC,IAAD,KAEI,kBAAC,IAAD,CAAOC,KAAK,IAAIC,UAAWrF,IAC3B,kBAAC,IAAD,CAAOoF,KAAK,SAASC,UAAWJ,UAPpD,GAA4BK,IAAMN,W,SCE5BO,EAAiBC,cACjBC,EAAe,IAAIC,cACnBC,EAAUC,+BAAqBL,EAAgBE,GAkBtCI,E,uKAbP,OACI,kBAAC,WAAD,CAAUC,SAAU,4CAChB,kBAACC,EAAA,EAAD,MACA,kBAAC,IAAaC,EACV,kBAAC,IAAD,CAAQL,QAASA,GACb,kBAAC,IAAD,CAAON,UAAWF,W,GARxBG,IAAMN,WCPxBiB,IAASC,OAAO,kBAAC,EAAD,MAASzD,SAAS0D,eAAe,W","file":"static/js/main.0dd7945c.chunk.js","sourcesContent":["// 放所有 http 请求\nimport {AxiosInstance} from 'axios'\nimport {ReqType, wrapSend, Response, createRequest} from \"./req\";\n\n\n\nexport class Api {\n    request: AxiosInstance  // 普通请求\n    down: AxiosInstance     // 下载请求\n\n    constructor(request: ReqType) {\n        this.request = request.http\n        this.down = request.down\n    }\n\n    private download = async <T = any>(url = '', body: any = {}) => {\n        const res = await wrapSend<T>(() => {\n            return this.request.post<Response>(url, body, {responseType: 'blob'})\n        }, 'down')\n        return res\n    }\n\n    private post = async <T = any>(url = '', body?: any) => {\n        const res = await wrapSend<T>(() => {\n            return this.request.post<Response>(url, body)\n        })\n        return res\n    }\n\n    // 上传音频文件\n    uploadAudio = (payload: any) => {\n        return this.post(`/api/upload`, payload)\n    }\n}\n\nconst getAPI = (request: ReqType) => new Api(request)\n\nexport default getAPI(createRequest())","class Root {}\n\nexport default new Root()\n","import axios, {AxiosInstance, AxiosPromise} from \"axios\";\r\n\r\n\r\nexport interface ReqType {\r\n    http: AxiosInstance\r\n    down: AxiosInstance\r\n}\r\n\r\nexport interface Response {\r\n    success: boolean\r\n    msg?: string\r\n    data: any\r\n}\r\n\r\nexport interface Res<T> {\r\n    success: boolean\r\n    info: string\r\n    data?: T\r\n}\r\n\r\ntype requestFun = () => AxiosPromise<Response>\r\n\r\nexport const createRequest = (): ReqType => {\r\n    const common = {\r\n        baseURL: '',\r\n        headers: {\r\n            'Content-Type': 'application/json',\r\n            Token: sessionStorage.getItem('token')\r\n        }\r\n    }\r\n    // 设置请求拦截，在请求头中添加产品名称\r\n    const instance = axios.create(common)\r\n    return {\r\n        http: instance,\r\n        down: axios.create({ ...common, responseType: 'blob' })\r\n    }\r\n}\r\n\r\n\r\nexport const wrapSend = async <T>(requestFunc: requestFun, type?: string): Promise<Res<T>> => {\r\n    let response\r\n    try {\r\n        const res = await requestFunc()\r\n        const {data} = res\r\n        response = {\r\n            success: type ? true : data.success,\r\n            info: data.msg,\r\n            data: type ? data : data.data\r\n        }\r\n    } catch (err) {\r\n        const {data} = err.response\r\n        if (err.response.status === 403) {\r\n            setTimeout(() => {\r\n                sessionStorage.clear()\r\n                window.location.replace('/login')\r\n            }, 2000)\r\n            return {\r\n                info: 'Your login information is invalid, please login again!',\r\n                success: false\r\n            }\r\n        }\r\n        response = {\r\n            success: data.success,\r\n            info: data.err_msg,\r\n            data: data\r\n        }\r\n    }\r\n    return response\r\n}","import React, {Component} from \"react\";\r\nimport \"./index.css\";\r\nimport api from '../../api'\r\n\r\nimport Recorder from 'recorder-core'\r\nimport 'recorder-core/src/engine/mp3'\r\nimport 'recorder-core/src/engine/mp3-engine'\r\nimport 'recorder-core/src/extensions/waveview'\r\n\r\nimport {makeStyles} from '@material-ui/core/styles';\r\nimport {green} from '@material-ui/core/colors';\r\nimport CircularProgress from '@material-ui/core/CircularProgress'\r\nimport {Fab, Button, Container, Grid, Paper} from \"@material-ui/core\";\r\nimport {Provider} from \"mobx-react\";\r\n\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    root: {\r\n        display: 'flex',\r\n        alignItems: 'center',\r\n    },\r\n    wrapper: {\r\n        margin: theme.spacing(1),\r\n        position: 'relative',\r\n    },\r\n    buttonSuccess: {\r\n        backgroundColor: green[500],\r\n        '&:hover': {\r\n            backgroundColor: green[700],\r\n        },\r\n    },\r\n    fabProgress: {\r\n        color: green[500],\r\n        position: 'absolute',\r\n        top: -6,\r\n        left: -6,\r\n        zIndex: 1,\r\n    },\r\n    buttonProgress: {\r\n        color: green[500],\r\n        position: 'absolute',\r\n        top: '50%',\r\n        left: '50%',\r\n        marginTop: -12,\r\n        marginLeft: -12,\r\n    },\r\n}));\r\n\r\nexport default class demo extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            rec: null,\r\n            status: 'init',\r\n            src: '',\r\n        }\r\n    }\r\n\r\n    wave;\r\n    rec = Recorder({\r\n        type: 'mp3',\r\n        bitRate: 128,\r\n        sampleRate: 16000,\r\n        disableEnvInFix: false,\r\n        onProcess: (buffers, powerLevel, bufferDuration, bufferSampleRate) => {\r\n            this.wave.input(buffers[buffers.length - 1], powerLevel, bufferSampleRate);//输入音频数据，更新显示波形\r\n        }\r\n    })\r\n\r\n    renderVisualization = (hid) => {\r\n        return <Paper style={{height: '50px'}} className='wave-box'/>\r\n    }\r\n\r\n    componentDidMount() {\r\n        const t = setTimeout(() => {\r\n            console.log(\"无法录音：权限请求被忽略（超时假装手动点击了确认对话框）\", 1);\r\n        }, 8000);\r\n\r\n        console.log(\"正在打开录音，请求麦克风权限...\");\r\n        this.rec.open(() => {\r\n            clearTimeout(t);\r\n            console.log(\"已打开录音，可以点击开始了\", 2);\r\n            this.wave = Recorder.WaveView({elem: \".wave-box\"}); // 创建wave对象\r\n\r\n            //rec.start() 此处可以立即开始录音，但不建议这样编写，因为open是一个延迟漫长的操作，通过两次用户操作来分别调用open和start是推荐的最佳流程\r\n        }, (msg, isUserNotAllow) => {//用户拒绝未授权或不支持\r\n            clearTimeout(t);\r\n            console.log((isUserNotAllow ? \"UserNotAllow，\" : \"\") + \"无法录音:\" + msg, 1);\r\n        });\r\n    }\r\n\r\n    uploadFile = (e) => {\r\n        const formData = new FormData()\r\n        formData.append('record', e)\r\n        api.uploadAudio(formData).then(resp => {\r\n            console.log('resp', resp)\r\n        })\r\n    }\r\n\r\n    uploadFile2 = (blob, duration) => {\r\n        const formData = new FormData()\r\n        formData.append('record', blob, duration + '.mp3')\r\n        api.uploadAudio(formData).then(resp => {\r\n            console.log('resp', resp)\r\n        })\r\n    }\r\n\r\n    recStart = (call) => {\r\n        call || (call = function (msg) {\r\n            msg && console.log(msg, 1);\r\n        });\r\n        if (this.rec && Recorder.IsOpen()) {\r\n            this.rec.start();\r\n            const set = this.rec.set;\r\n            console.log(\"录制中：\" + set.type + \" \" + set.sampleRate + \"hz \" + set.bitRate + \"kbps\");\r\n        } else {\r\n            call(\"未打开录音\")\r\n        }\r\n    }\r\n\r\n    mouseDown = () => {\r\n        this.setState({status: 'recording'})\r\n        this.recStart()\r\n        document.onmouseup = this.touchUp\r\n    }\r\n\r\n    touchUp = () => {\r\n        this.setState({status: 'stopped'})\r\n        this.recStop()\r\n    }\r\n\r\n    touchDown = () => {\r\n        this.setState({status: 'recording'})\r\n        this.recStart()\r\n    }\r\n\r\n    recStop() {\r\n        this.rec.stop((blob, duration) => {\r\n            // this.rec.close();//释放录音资源，当然可以不释放，后面可以连续调用start；但不释放时系统或浏览器会一直提示在录音，最佳操作是录完就close掉\r\n            this.uploadFile2(blob, duration)\r\n            this.setState({src: window.URL.createObjectURL(blob)}, ()=>{\r\n                console.log(\"src\", this.state.src)\r\n            })\r\n            // this.rec = null;\r\n        }, (msg) => {\r\n            console.log(\"录音失败:\" + msg, 1);\r\n            // this.rec.close();//可以通过stop方法的第3个参数来自动调用close\r\n            // this.rec = null;\r\n        });\r\n    }\r\n\r\n    playAndStop = ()=> {\r\n        this.refs.audio.play()\r\n    }\r\n\r\n    render() {\r\n        const {status, loadings, src} = this.state;\r\n        const recording = status === 'recording'\r\n        return (\r\n            <Container maxWidth='sm'>\r\n                <div>\r\n                    <Button type=\"primary\" onClick={() => this.recStart()}>\r\n                        New Start\r\n                    </Button>\r\n                    <Button type=\"primary\" onClick={() => this.recStop()}>\r\n                        New Stop\r\n                    </Button>\r\n                </div>\r\n                <Grid container spacing={2} className={useStyles.wrapper} alignItems={'center'}>\r\n                    <Grid item xs={3}>\r\n                        <Fab\r\n                            variant=\"extended\"\r\n                            onMouseDown={this.mouseDown}\r\n                            onTouchStart={this.touchDown}\r\n                            onTouchEnd={this.touchUp}\r\n                            size=\"medium\"\r\n                            color={recording ? 'default' : 'primary'}\r\n                        >{recording ? '松开结束' : '按住录音'}</Fab>\r\n                        {/*{recording && <CircularProgress size={24} className={useStyles.buttonProgress}/>}*/}\r\n                    </Grid>\r\n                    <Grid item xs={6}>\r\n                        {this.renderVisualization()}\r\n                    </Grid>\r\n                    <Grid item xs={3} alignContent={'center'}>\r\n                        <Button color='secondary' variant='contained' onClick={this.playAndStop}>Play</Button>\r\n                    </Grid>\r\n                    <audio controls ref={'audio'} src={src} style={{display: 'block'} }></audio>\r\n                </Grid>\r\n            </Container>\r\n        );\r\n    }\r\n}\r\n","import React, {lazy} from 'react'\r\nimport {Route, Switch} from 'react-router-dom'\r\n// todo\r\nimport demo from 'containers/demo/demo'\r\n\r\nconst LoginContainer = lazy(() => import('containers/login'))\r\n\r\nexport class Routes extends React.Component<any> {\r\n    render() {\r\n        return (\r\n            <>\r\n                <Switch>\r\n                    {/*<Redirect exact={true} from=\"/\" to=\"/login\" />*/}\r\n                    <Route path=\"/\" component={demo}/>\r\n                    <Route path=\"/login\" component={LoginContainer}/>\r\n                </Switch>\r\n            </>\r\n        )\r\n    }\r\n}\r\n\r\nexport default Routes\r\n","import React, {Suspense} from 'react'\r\nimport {createBrowserHistory} from 'history'\r\nimport {Provider} from 'mobx-react'\r\nimport {RouterStore, syncHistoryWithStore} from 'mobx-react-router'\r\nimport RootStore from './stores/root'\r\nimport {Route, Router} from 'react-router-dom'\r\nimport Routes from './routes'\r\nimport CssBaseline from '@material-ui/core/CssBaseline';\r\n\r\nconst browserHistory = createBrowserHistory()\r\nconst routingStore = new RouterStore()\r\nconst history = syncHistoryWithStore(browserHistory, routingStore)\r\n\r\nclass App extends React.Component {\r\n\r\n    public render() {\r\n        return (\r\n            <Suspense fallback={<div>Loading...</div>}>\r\n                <CssBaseline/>\r\n                <Provider {...RootStore}>\r\n                    <Router history={history}>\r\n                        <Route component={Routes}/>\r\n                    </Router>\r\n                </Provider>\r\n            </Suspense>\r\n        )\r\n    }\r\n}\r\n\r\nexport default App\r\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport './index.scss'\nimport './normalize.css'\nimport App from './App'\n\nReactDOM.render(<App />, document.getElementById('root'))\n"],"sourceRoot":""}